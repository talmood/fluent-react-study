# 3 가상 DOM


## 3.1 가상 DOM 소개
- **DOM(Document Object Model)** : 문서 객체 모델 
- **가상 DOM**
  - HTML 문서를 자바스크립트 객체로 모델링 한것
  - 실제 DOM 의 가벼운 복사본

| 실제 DOM | 가상 돔  |
|--------|-------| 
| 노드 객체  | JS 객체 |
| 리플로    | 재조정   |

- 리플로 : 브라우저가 문서의 전체나 일부 레이아웃을 다시 계산하는 과정
  - 리플로 발생 시 성능에 영향이 있고, 직접적인 DOM 상호 작용이 비효율적으로 동작

- 재조정 : 리액트는 UI 변경을 요청할 때 가상 DOM 을 먼저 업데이트 후 실제 돔을 업데이트 함
  - 가상 DOM 업데이트 
    - 실제 페이지 레이아웃을 변경하지 않기 때문에 빠르게 동작 
    - 비교 알고리즘으로 가상돔 이전 버전과 새버전의 차이점을 식별하여 실제 DOM 업데이트에 필요한 최소한 변경사항을선정하고, 성능 영향을 최소화함


## 3.2 실제 DOM
- DOM: 브라우저가 HTML을 분석해 생성한 노드와 객체의 트리 구조. 웹 페이지의 현재 상태를 실시간으로 표현하며, 사용자 상호작용에 따라 계속 업데이트됨.


### 3.2.1 실제 DOM의 문제점
- 성능
  - 레이아웃 재계산: DOM을 직접 조작할 때마다 브라우저는 레이아웃을 재계산하고 페이지를 다시 그림. 복잡한 웹 페이지에서 성능 저하를 유발
- 브라우저간 호환성
  - 브라우저마다 DOM 모델링 방식이 다르기 때문에, 웹 애플리케이션의 일관성을 유지하기 어려움.
  - **리액트 해결책** 
    - SyntheticEvent: 브라우저의 기본 이벤트를 감싸는 래퍼 객체로, 브라우저 간 일관성을 보장함.
    - 이벤트 위임: 이벤트 리스너를 개별 요소가 아닌 상위 요소에 위임해 이벤트 핸들링을 최적화.
    - 통합 인터페이스: 브라우저 간 차이를 추상화해 개발자가 일관된 방식으로 이벤트를 처리할 수 있도록 함.
- 보안 취약성
  - DOM을 직접 조작하면 크로스 사이트 스크립팅(XSS)과 같은 보안 취약점이 발생할 수 있음.


### 3.2.2 문서 조각 
- 문서 조각 : DOM 노드를 저장하는 가벼운 컨테이너, 기본 DOM 에 영향을 주지 않고 업데이트를 수행할 수 있는 임시 저장소 역할
  - 일괄 업데이트
    - 문서 조각 내에서 얼마나 많은 엘리먼트나 업데이트를 수행했든 리플로와 리페인팅은 한 번만 수행됩니다.
  - 메모리 효율성
    - 문서 조각에 추가된 노드는 문서의 실제 DOM에서 제거됩니다. 이는 문서에서 큰 영역을 재정렬할 때 메모리 사용량을 최적화하는 데 일조합니다.
  - 중복 렌더링 방지
    - 문서 조각은 활성화된 문서 DOM 트리에 속하지 않으므로 문서 조각을 변경해도 실제 문서에는 영향을 주지 않으며, 실제 DOM에 추가될 때까지 스타일과 스크립트가 적용되지 않습니다. 이를 통해 스타일 재계산과 스크립트 실행의 중복 수행을 방지합니다.

## 3.3 가상 DOM 작동 방식


### 3.3.1 리액트 엘리먼트
- **리액트 엘리먼트**: `React.createElement`로 생성된 객체로, 가상 DOM을 구성하는 기본 단위.

| 리액트 엘리먼트 주요 속성 |                     |
|----------------|---------------------|
| `$$typeof`     | 유효한 리액트 엘리먼트 확인용 심볼 |
| `type`         | 엘리먼트/컴포넌트 종류 지정     |
| `ref`          | DOM 노드 참조용          |
| `props`        | 컴포넌트에 전달된 속성들       |
| `_owner`       | 엘리먼트 생성 컴포넌트 추적     |
| `_store`       | 리액트 내부용 추가 데이터 저장   |

### 3.3.2 가상 DOM 과 실제 DOM 비교 


| `React.createElement`    | 메모리에 가상 엘리먼트 생성 |
|--------------------------|---------------|
| `document.createElement` | DOM 엘리먼트 생성|

- 재조정 프로세스: 리액트는 컴포넌트가 렌더링될 때 새로운 가상 DOM 트리를 생성하고, 이전 트리와 비교해 변경된 부분만 실제 DOM에 반영함.


### 3.3.3 효율적인 업테이트 
- 디핑 알고리즘:
  - 루트 노드 비교: 루트 노드가 다르면 전체 트리를 교체.
  - 속성 및 자식 노드 비교: 변경된 속성과 자식 노드만 업데이트.
  - Key 프롭: `key` 속성을 사용해 노드의 교체 여부를 결정.
- 불필요한 리렌더링: 상태나 프롭이 변경되지 않은 컴포넌트도 리렌더링될 수 있음. 이를 최소화하기 위해 `React.memo`, `useMemo`, `useCallback` 등을 사용.

