# 4 재조정

## 4.1  재조정 이해하기
- 가상돔 : 우리가 원하는 UI 상태의 청사진
- 재조정(reconciliation) 이라는 프로세스를 통해 현실로 만듦
- 가상돔의 변경사항을 단 한번의 실제 DOM 업데이트로 일괄처리함


## 4.2 일괄 처리
* (3장) 문서조각 : 다수의 DOM 노드를 포함하는 가벼운 컨테이너
* 일종의 임시 스테이징 영역처럼 동작해서 문서의 실제 DOM에 영향을 주지 않고 여러 변경 사항을 반영
* 최종적으로 문서 조각을 DOM에 추가하면 단 한번의 리플로와 리페인팅이 발생함

- 비슷한 맥락으로~ 리액트는 재조정 과정에서 여러 가상 DOM 업데이트를 모아 한번의 업데이트로 결합한 후 실제 DOM 에 대한 업데이트를 일괄 처리함

```typescript
function Example(){
    const [count, setCount] = useState(0);
    
     const handleClick = () =>{
         setCount((prevCount)=> prevCount+1);
         setCount((prevCount)=> prevCount+1);
         setCount((prevCount)=> prevCount+1);
     }
    return(
        <div>
            <p> 카운트 : {count} </p>
    <button onClick={handleClick}>증가</button>
    )
}

```
리액트는 일괄 처리를 해서 count +3으로 DOM을 한번만 업데이트 한다


## 4.3 기존기술
~ 예전 기술 ~ 렌더링에 스택 데이터 구조를 사용했음 
### 4.3.1 스택 재조정자
- 스택은 LIFO(후입선출) 구조

무튼 문제가 많았음
그래서 나온게~~

### 4.4 파이버 재조정자
- 파이버 : 조정자를 위한 작업 단위  [데이터 구조]
- 파이버는 상태를 저장하고 수명이 긺 / 리액트 앨리먼트는 임시적이고 상태가 없음
- 파이버 : 특정 시점에 존재하는 실제 컴포넌트 트리를 나타내는 리액트의 내부 데이터 구조

리액트는 재조정에 파이버 트리를 씀 ..! 

### 4.4.1 데이터 구조로서의 파이버 !
파이버 데이터 구조 - 퍼이버 재조정자의 핵심요소,,,
파이버 재조정자는 업데이트의 우선순위를 정하고 일에따라 동시 실행을 가능케해서 리액트 애플리케이션의 성능과 응답성을 향상 시킴

파이버데이터 구조는 리액트의 애플리케이션에서 컴포넌트의 인스턴스와 그 상태를 표현함

파이버 노드의 각 인스턴스에는 해당 컴포넌트의 프롭, 상태, 하위 컴포넌트, 컴포넌트 트리에서 위치 정보, 메타데이터가 들어있다


파어이어 노드

|tag|클래스 컴포넌트, 클래스 컴포넌트 유형에는 고유한 숫자 ID가 파이버로 설정됨
|--|--|
|type | 파이퍼가 나타내는 함수 또는 클래스 컴포넌트|
|props| 입력 프롭 또는 함수에 대한 입력 인수|
|stateNode|컴포넌트의 인스턴스. 컴포넌트 트리에서 위치는 return, child, sibling, index로 표현|

파이버 재조정에는 현재 파이버 트리와 다음 파이버  트리를 비교해 어느 노드를 업데이트, 추가, 제거할지 파악하는 작업이 포함되어있음
조정 과정 중에서 파이버 재조정자가 가상돔의 각 리액트 엘리먼트에 대해 파이버 노드를 생성함==> createFiberFOrmTypeAndProps 

createFiberFOrmTypeAndProps 함수는 엘리먼트에서 파생된 파이버를 반환

파이버 노드가생성되면 작업루프를 사용해 사용자 인터페이스를 업데이트한다 작업루프는 루트파이버노드에서 시작해서 컴포넌트 트리를 따라 내려가면서 필요할 경우 파이버 노드를 더티로 표시함
끝애 도달하면.....

### 4.4.2 더블 버퍼링

### 4.4.3 파이버 재조정

파이버 재조정은 랜더링 단계와 커밋단계로 나눠짐

                                            랜더링 단계                              커밋단계
         작업루프(workloop)  -  [ 작업시작(beginwork) - 작업완료(completeWork) ] - [커밋(commitRoot)]



#### 렌더링 단계
렌더링 단계는 현재 트리에서 상태 변경 이벤트가 발생하면 시작

#### 작업시작
#### 작업완료
#### 커밋 단계 
#### 변형 단계
#### 레이아웃 단계
#### 효과 !

리액트 재조정 과정의 커밋 단계에서는 여러 부작용이 특정 순서로 실행되며 그 순서는 효과 종류에 따라 달라짐
커밈ㅅ단계에 발생하는 효과
- 배치효과
- 업데이트 효과
- 삭제 효과
- 레이아웃 효과

페시브 효과는 브라우저의 페인트 가능 시점 후에 실행되도록 예약된 사용자 정의 효과이며 useEffect 훅을 사용해 관리함

패시브 효과는 API 에서 데이터 요청이나 분석 추적처럼 페이지의 초기 렌더링에 중요하지 않은 작업을 수행하는데 유용함



화면에 모두 표시하기

